#!/usr/bin/env bash

config_file="{{ CKAN_CONFIG }}/{{ CKAN_CONFIG_FILE }}";
units_json_path=/app/roles/portal/templates/ckan/units.json.j2
units_json_final_path={{ CKAN_DIST_CONFIG }}/units.json

config_line=$(grep -n '#units_url' /etc/ckan/default/production.ini | awk -F  ":" '{print $1}')
if ! [[ -z $config_line ]] ; then
    cp $units_json_path $units_json_final_path
    sed -i "${config_line}s|.*|units_url = file:///var/lib/ckan/theme_config/units.json|" $config_file
fi
